webpackJsonp([1],{Fy2T:function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},Mp08:function(t,e,n){"use strict";var i=n("mtWM"),r=n.n(i),o=n("fZjL"),s=n.n(o),a={vuex:{actions:{addComment:function(t,e){return e._token=t.state.csrf,r.a.post("/comments",e).then(function(e){t.dispatch("ADD_COMMENT",e.data)})},replyTo:function(t,e){t.dispatch("REPLY_TO",e)}}},data:function(){return{errors:{},username:"",email:"",content:"",loading:!1}},props:{id:Number,model:String,reply:{type:Number,default:0}},methods:{sendComment:function(){var t=this;this.errors={},this.loading=!0,this.addComment({commentable_id:this.id,commentable_type:this.model,content:this.content,username:this.username,email:this.email,reply:this.reply}).catch(function(e){t.errors=e.response.data,console.log(t.errors)}).then(function(){t.loading=!1,0===s()(t.errors).length&&(t.username="",t.content="",t.email="",t.replyTo(0))})}}},c=n("XyMi"),l=Object(c.a)(a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h3",{staticClass:"ui header dividing"},[t._v(t._s(0==t.reply?"Commenter":"Répondre"))]),t._v(" "),n("form",{staticClass:"ui form",staticStyle:{position:"relative"},attrs:{action:""},on:{submit:function(e){e.preventDefault(),t.sendComment(e)}}},[t.loading?n("div",{staticClass:"ui inverted active dimmer"},[n("div",{staticClass:"ui text loader"},[t._v("Récupération des commentaires...")])]):t._e(),t._v(" "),n("div",{staticClass:"two fields"},[n("div",{staticClass:"field",class:{error:t.errors.username}},[n("label",[t._v("Pseudo")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"field",class:{error:t.errors.email}},[n("label",[t._v("Email")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],attrs:{type:"text"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._v(" "),t.errors.email?n("span",{staticClass:"danger"},[t._v(t._s(t.errors.email.join(", ")))]):t._e()])]),t._v(" "),n("div",{staticClass:"field",class:{error:t.errors.content}},[n("label",[t._v("Votre commentaire")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{cols:"30",rows:"10"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),n("button",{staticClass:"ui blue labeled submit icon button"},[n("i",{staticClass:"icon edit"}),t._v("\n      "+t._s(0==t.reply?"Commenter":"Répondre")+"\n    ")]),t._v(" "),t.reply>0?n("button",{staticClass:"ui grey labeled submit icon button",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.replyTo(0)}}},[n("i",{staticClass:"icon cancel"}),t._v("\n      Annuler\n    ")]):t._e()])])},[],!1,null,null,null).exports,u={name:"comment",vuex:{actions:{replyTo:function(t,e){t.dispatch("REPLY_TO",e)},deleteComment:function(t,e){return r.a.delete("/comments/"+e.id,{params:{_token:t.state.csrf}}).then(function(e){t.dispatch("DELETE_COMMENT",e.data)})}},getters:{reply:function(t){return t.reply}}},methods:{deleteCommentAction:function(){var t=this;this.loading=!0,this.deleteComment(this.comment).catch(function(t){window.alert(t.data)}).then(function(){t.loading=!1})}},data:function(){return{loading:!1}},components:{CommentForm:l},computed:{form_visible:function(){return this.reply===this.comment.id},reply_to:function(){return 0===this.comment.reply?this.comment.id:this.comment.reply},can_delete:function(){return this.ip===this.comment.ip_md5}},props:{ip:String,comment:Object}},m={data:function(){return{loading:!1,transition:!1}},vuex:{getters:{comments:function(t){return t.comments},reply:function(t){return t.reply}},actions:{getComments:function(t,e,n){return r.a.get("/comments",{params:{id:n,type:e}}).then(function(e){t.dispatch("ADD_COMMENTS",e.data)})},setCSRFToken:function(t,e){t.dispatch("CSRF_TOKEN",e)}}},components:{Comment:Object(c.a)(u,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment",staticStyle:{position:"relative"}},[t.loading?n("span",{staticClass:"ui inverted active dimmer"},[n("div",{staticClass:"ui text loader"})]):t._e(),t._v(" "),n("div",{staticClass:"avatar"},[n("img",{attrs:{src:"https://img.etsystatic.com/il/5e3fc7/1258695533/il_570xN.1258695533_9o6p.jpg"+t.comment.email_md5,alt:""}})]),t._v(" "),n("div",{staticClass:"content"},[n("span",{staticClass:"author"},[t._v(t._s(t.comment.username))]),t._v(" "),n("div",{staticClass:"metadata"},[n("span",{staticClass:"date"},[t._v(t._s(t._f("ago")(t.comment.created_at)))]),t._v(" "),t.can_delete?n("span",{staticStyle:{color:"#ff0000"},on:{click:t.deleteComment}}):t._e()]),t._v(" "),n("div",{staticClass:"text"},[t._v("\n      "+t._s(t.comment.content)+"\n    ")]),t._v(" "),n("div",{staticClass:"actions"},[n("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.replyTo(t.reply_to)}}},[t._v("Répondre")])])]),t._v(" "),n("div",{staticClass:"comment"},[t._l(t.comment.replies,function(e,i){return n("comment",{key:i,attrs:{comment:e,ip:t.ip,transition:"fade-from-right"}})}),t._v(" "),t.form_visible?n("comment-form",{attrs:{id:t.comment.commentable_id,model:t.comment.commentable_type,reply:t.comment.id}}):t._e()],2)])},[],!1,null,null,null).exports,CommentForm:l},props:{id:Number,model:String,csrf:String,ip:String},mounted:function(){var t=this;this.setCSRFToken(this.csrf);window.addEventListener("scroll",function e(){t.$el.getBoundingClientRect().top-window.innerHeight<=0&&(t.loading=!0,t.getComments(t.model,t.id).then(function(){t.loading=!1,t.$nextTick(function(){t.transition="fade-from-right"})}),window.removeEventListener("scroll",e))})}},d=Object(c.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ui comments"},[t.loading?n("div",{staticClass:"ui inverted active dimmer"},[n("div",{staticClass:"ui text loader"},[t._v("Récupération des commentaires...")])]):t._e(),t._v(" "),t._l(t.comments,function(e,i){return n("comment",{key:i,attrs:{comment:e,ip:t.ip,transition:t.transition}})}),t._v(" "),0==t.reply?n("comment-form",{attrs:{id:t.id,model:t.model}}):t._e()],2)},[],!1,null,null,null);e.a=d.exports},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var e=n("7+uW"),i=n("Mp08"),r=n("wtEF"),o=n("a2Qx");n("pyWk"),e.a.filter("ago",o.a),t.store=r.a,new e.a({el:"#app",store:r.a,components:{Comments:i.a}})}.call(e,n("Fy2T"))},Zlql:function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c,l=[],u=!1,m=-1;function d(){u&&c&&(u=!1,c.length?l=c.concat(l):m=-1,l.length&&f())}function f(){if(!u){var t=a(d);u=!0;for(var e=l.length;e;){for(c=l,l=[];++m<e;)c&&c[m].run();m=-1,e=l.length}c=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new p(t,e)),1!==l.length||u||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=v,r.addListener=v,r.once=v,r.off=v,r.removeListener=v,r.removeAllListeners=v,r.emit=v,r.prependListener=v,r.prependOnceListener=v,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},a2Qx:function(t,e,n){"use strict";var i={allowFuture:!0,prefixAgo:null,prefixFromNow:null,numbers:[],suffixAgo:"",suffixFromNow:"maintenant",seconds:"il y a moins d'une minute",minute:"il y a 1 minute",minutes:"il y a %d minutes",hour:"il y a 1 heure",hours:"il y a %d heures",day:"il y a 1 jour",days:"il y a %d jours",month:"il y a 1 mois",months:"il y a %d mois",year:"il y a 1 an",years:"il y a %d ans"};function r(t,e){return null==t&&(t=new Date),null==e&&(e=new Date),function(t){var e,n,r,s,a,c,l,u;a=i.prefixAgo,l=i.suffixAgo,i.allowFuture&&t<0&&(a=i.prefixFromNow,l=i.suffixFromNow);return c=Math.abs(t)/1e3,e=(n=(r=(s=c/60)/60)/24)/365,u=c<45&&o(i.seconds,Math.round(c))||c<90&&o(i.minute,1)||s<45&&o(i.minutes,Math.round(s))||s<90&&o(i.hour,1)||r<24&&o(i.hours,Math.round(r))||r<48&&o(i.day,1)||n<30&&o(i.days,Math.floor(n))||n<60&&o(i.month,1)||n<365&&o(i.months,Math.floor(n/30))||e<2&&o(i.year,1)||o(i.years,Math.floor(e)),[a,u,l].join(" ").toString().trim()}(e.getTime()-t.getTime())}function o(t,e){var n;return n=i.numbers&&i.numbers[e]||e,t.replace(/%d/i,n)}e.a=function(t){var e=new Date(t),n=e.getTimezoneOffset();return r(new Date(e.getTime()-1e3*n*60))}},pyWk:function(t,e){},wtEF:function(t,e,n){"use strict";var i=n("Gu7T"),r=n.n(i),o=n("7+uW"),s=n("r8sI"),a=n.n(s);o.a.use(a.a);var c={ADD_COMMENTS:function(t,e){var n;(n=t.comments).push.apply(n,r()(e))},ADD_COMMENT:function(t,e){if(e.reply){var n=t.comments.find(function(t){return t.id===e.reply});void 0===n.replies&&(n.replies=[]),n.replies.push(e)}else t.comments.push(e)},DELETE_COMMENT:function(t,e){if(e.reply){var n=t.comments.find(function(t){return t.id===e.reply}),i=n.replies.findIndex(function(t){return t.id===e.id});n.replies.splice(i,1)}else{var r=t.comments.findIndex(function(t){return t.id===e.id});t.comments.splice(r,1)}},CSRF_TOKEN:function(t,e){t.token=e},REPLY_TO:function(t,e){t.reply=e}};e.a=new a.a.Store({state:{comments:[],token:"",reply:0},mutations:c})}},["NHnr"]);
//# sourceMappingURL=app.1a60883c32d59d25efd8.js.map